<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>D.O.H.: Dojo Objective Harness &mdash; The Dojo Toolkit - Reference Guide</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.10.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>

    <link rel="stylesheet" href="../../../../css/guide.css">
    <script type="text/javascript">
      dojoConfig = {
        async: true
      };
    </script>
    <script src="../../../scripts/dojo/dojo/dojo.js"></script>
    <script src="../../../../scripts/guide/docs/guide.js"></script>
    <link rel="stylesheet" href="../../../../scripts/dojo/dijit/themes/claro/claro.css">

  </head>
  <body role="document">
  

    <div class="document">

  <div class="nav">
	<div class="row">
		<div class="small-3 columns">
			<a href="/" class="navLogo"><span>Dojo</span></a>
		</div>
		<div class="small-9 columns text-right">
			<div class="mobileMenuToggle" data-menu-toggle></div>
			<div class="menu">
				<div class="mobileHeader">Menu</div>
				<ul class="inline-list menuItems right">
					<li><a href="">Get Dojo</a></li>
					<li><a href="/documentation/">Docs</a></li>
					<li><a href="">Help &amp; Support</a></li>
					<li><a href="">Blog</a></li>
					<li><a href="">Get Involved</a></li>
				</ul>
			</div>
		</div>
	</div>
</div>
  <main class="refguide">
    <div class="row">

      <div class="medium-3 columns sideNav">
        <h4>Reference Guide</h4>
        <div id="dtkVersion">
          <label for="refver">Dojo Version</label>
          <select id="refver" name="refver">
            <option value="1.6">1.6</option>
            <option value="1.7">1.7</option>
            <option value="1.8">1.8</option>
            <option value="1.9">1.9</option>
            <option value="1.10" selected="selected">1.10</option>
          </select>
        </div>
        <ul>
          <li><a href="../index.html">Startpage</a></li>
          <li><a href="../dojo/index.html">Dojo</a></li>
          <li><a href="../dijit/index.html">Dijit</a></li>
          <li><a href="../dojox/index.html">DojoX</a></li>
        </ul>
        <ul>
<li><a class="reference internal" href="#">D.O.H.: Dojo Objective Harness</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#enter-d-o-h-the-dojo-objective-harness">Enter D.O.H. The Dojo Objective Harness</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests">Running tests</a><ul>
<li><a class="reference internal" href="#in-a-browser">In a browser</a><ul>
<li><a class="reference internal" href="#testing-parts-of-dojo">Testing parts of Dojo</a></li>
<li><a class="reference internal" href="#testing-your-own-code">Testing your own code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#on-the-command-line-with-rhino">On the command line (with Rhino)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-tests">Creating tests</a><ul>
<li><a class="reference internal" href="#example-test-module-simple-test-registration">Example Test Module: Simple test registration</a></li>
<li><a class="reference internal" href="#example-test-module-module-that-loads-other-modules">Example Test Module: Module that loads other modules</a></li>
<li><a class="reference internal" href="#notes-on-registering-tests">Notes on Registering Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-tests">Performance Tests</a></li>
<li><a class="reference internal" href="#reference">Reference</a><ul>
<li><a class="reference internal" href="#file-structure">File Structure</a></li>
<li><a class="reference internal" href="#registration-functions">Registration Functions</a><ul>
<li><a class="reference internal" href="#doh-register">doh.register(...)</a></li>
<li><a class="reference internal" href="#doh-registertest-group-testfuncorobj">doh.registerTest(group, testFuncOrObj)</a></li>
<li><a class="reference internal" href="#doh-registertests-group-testfuncorobjarr">doh.registerTests(group, testFuncOrObjArr)</a></li>
<li><a class="reference internal" href="#doh-registertestns-group-obj">doh.registerTestNs(group, obj)</a></li>
<li><a class="reference internal" href="#doh-registertesturl-url">doh.registerTestUrl(url)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-functions">Test Functions</a><ul>
<li><a class="reference internal" href="#doh-asserttrue-boolean">doh.assertTrue(boolean)</a></li>
<li><a class="reference internal" href="#doh-assertfalse-boolean">doh.assertFalse(boolean)</a></li>
<li><a class="reference internal" href="#doh-assertequal-obj1-obj2">doh.assertEqual(obj1, obj2)</a></li>
<li><a class="reference internal" href="#doh-assertnotequal-obj1-obj2">doh.assertNotEqual(obj1, obj2)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-structures">Test Structures</a><ul>
<li><a class="reference internal" href="#simple-tests-no-setup-standalone-synchronous-test">Simple tests (no setup, standalone, synchronous test)</a></li>
<li><a class="reference internal" href="#simple-tests-no-setup-standalone-asynchronous-test">Simple tests (no setup, standalone, asynchronous test)</a></li>
<li><a class="reference internal" href="#test-fixture-setup-standalone-synchronous-test">Test Fixture (setup, standalone, synchronous test)</a></li>
<li><a class="reference internal" href="#test-fixture-setup-standalone-asynchronous-test">Test Fixture (setup, standalone, asynchronous test)</a></li>
<li><a class="reference internal" href="#performance-test-fixture-setup-standalone-synchronous-test">Performance Test Fixture (setup, standalone, synchronous test)</a></li>
<li><a class="reference internal" href="#performance-test-fixture-setup-standalone-asynchronous-test">Performance Test Fixture (setup, standalone, asynchronous test)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See also</a></li>
</ul>
</li>
</ul>

        

            <div id="searchbox" style="display: none">
                <h3>Quick search</h3>
                <form class="search" action="../search.html" method="get">
                    <input type="text" name="q" size="18" />
                    <input type="submit" value="Go" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                 </form>
                 <p class="searchtip" style="font-size: 90%">
                     Enter search terms or a module, class or function name.
                 </p>
            </div>
      </div>
      <div class="medium-9 columns content">
        
  <div class="section" id="d-o-h-dojo-objective-harness">
<span id="util-doh"></span><h1><a class="toc-backref" href="#id3">D.O.H.: Dojo Objective Harness</a><a class="headerlink" href="#d-o-h-dojo-objective-harness" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Authors:</th><td class="field-body">Alex Russell, Pete Higgins, Dustin Machi, Jared Jurkiewicz, Andy Balaam</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#d-o-h-dojo-objective-harness" id="id3">D.O.H.: Dojo Objective Harness</a><ul>
<li><a class="reference internal" href="#overview" id="id4">Overview</a><ul>
<li><a class="reference internal" href="#enter-d-o-h-the-dojo-objective-harness" id="id5">Enter D.O.H. The Dojo Objective Harness</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests" id="id6">Running tests</a><ul>
<li><a class="reference internal" href="#in-a-browser" id="id7">In a browser</a></li>
<li><a class="reference internal" href="#on-the-command-line-with-rhino" id="id8">On the command line (with Rhino)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-tests" id="id9">Creating tests</a><ul>
<li><a class="reference internal" href="#example-test-module-simple-test-registration" id="id10">Example Test Module: Simple test registration</a></li>
<li><a class="reference internal" href="#example-test-module-module-that-loads-other-modules" id="id11">Example Test Module: Module that loads other modules</a></li>
<li><a class="reference internal" href="#notes-on-registering-tests" id="id12">Notes on Registering Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-tests" id="id13">Performance Tests</a></li>
<li><a class="reference internal" href="#reference" id="id14">Reference</a><ul>
<li><a class="reference internal" href="#file-structure" id="id15">File Structure</a></li>
<li><a class="reference internal" href="#registration-functions" id="id16">Registration Functions</a></li>
<li><a class="reference internal" href="#test-functions" id="id17">Test Functions</a></li>
<li><a class="reference internal" href="#test-structures" id="id18">Test Structures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also" id="id19">See also</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id4">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Usually when people think of a scripting language, it&#8217;s often in the context of ease of use, simple syntax,
and something those without traditional computer science educations can grasp and use.
JavaScript unfortunately falls into this category.
For a scripting language, though, is difficult to fully master.
Making it worse are the environments that execute JavaScript; the infamous Web Browser.
For example, Safari works similar to, but not quite the same as Mozilla FireFox, Opera, and even Google Chrome.
When Internet Explorer enters the picture, it gets even more complicated as many JavaScript constructs
(and DOM functions) that work in all the other browsers will not work in Internet Explorer.
This becomes a <em>Testing Nightmare</em>.
In fact, I&#8217;m sure the frustration of testing JavaScript has caused many an utterance of &#8216;doh!&#8217;
and other less ahem, <em>polite</em> phrases.
So ... what can be done about this?</p>
<div class="section" id="enter-d-o-h-the-dojo-objective-harness">
<h3><a class="toc-backref" href="#id5">Enter D.O.H. The Dojo Objective Harness</a><a class="headerlink" href="#enter-d-o-h-the-dojo-objective-harness" title="Permalink to this headline">¶</a></h3>
<p>Just to get it out of the way ...
D.O.H. is both an acronym of Dojo Objective Harness <em>and</em> a play on the now commonplace expression of frustration &#8216;DOH!&#8217;.
But aside from the very silly name it is a unit test framework developed by the Dojo Toolkit Community
(primarily by Alex Russell), in an attempt to solve the complexities of testing JavaScript.
For example, in JavaScript, the use of XHR to request remote data asynchronously is commonplace ...
and yet few Unit Test frameworks provided any mechanism by which to actually be able test asynchronous functions.
Furthermore, most Unit Test Frameworks end up with specific dependencies on certain browsers or runtime environments.
Again, D.O.H. tries not to limit itself in this manner, it&#8217;s both flexible, extendable,
and runs in many environments from browsers to JS runtime environments such as Rhino.</p>
<p>Its main purpose is a framework for developers (both dojo committers and others),
to unit test out JavaScript functions and custom widgets.
Its goal isn&#8217;t so much as a way to test a full-blown web application as it is to test the parts
that make up the applications in a cross-browser (and even non-browser), compatible manner.
By having a good set of unit tests, developers can feel confident that code changes they later make
do not cause regressions in existing functions.</p>
<p>For a quick list of the features of D.O.H. see below:</p>
<ul class="simple">
<li>Support for many browsers:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Firefox 3.6+</li>
<li>Safari 4.x+</li>
<li>Internet Explorer 6+</li>
<li>Google Chrome All versions</li>
<li>Opera 9.x and 10.x</li>
<li>&lt;and others!&gt;</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Support for Non-Browser environments, such as Rhino and node.js.</li>
<li>Modular loading of unit test files.</li>
<li>Asynchronous test support (such as testing functions that ultimately use XHR)</li>
<li>A simple browser-based graphical front end and runner file.</li>
<li>Standard Unit Test Support (assertTrue, assertFalse, assertEqual, timeouts, etc.)</li>
<li>Performance tests with basic statistical computations.</li>
<li>Java Applet (D.O.H. Robot), for simulating user interaction to test browser input events.</li>
<li>If present, will use the Dojo Module Loader to load test files.</li>
<li>The ability to load separate HTML pages into an iframe, where the iframe contains a D.O.H. instance and register tests.
This allows D.O.H. to test HTML widgets in a separate frame from the D.O.H. framework, which avoids cross-contamination.</li>
</ul>
</div>
</div>
<div class="section" id="running-tests">
<h2><a class="toc-backref" href="#id6">Running tests</a><a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>Before you start writing your own tests you should confirm you can run some existing tests.  We&#8217;ll be using the tests that come as part of Dojo, confirming that Dojo itself works as it should, and then looking at how to run your own tests.</p>
<div class="section" id="in-a-browser">
<h3><a class="toc-backref" href="#id7">In a browser</a><a class="headerlink" href="#in-a-browser" title="Permalink to this headline">¶</a></h3>
<p>There are several ways to run DOH tests, but the simplest way is inside a web browser.</p>
<div class="section" id="testing-parts-of-dojo">
<h4>Testing parts of Dojo<a class="headerlink" href="#testing-parts-of-dojo" title="Permalink to this headline">¶</a></h4>
<p>The easiest tests to get running in DOH are those that are built into Dojo itself, so let&#8217;s start there.</p>
<p>Ensure your web server or equivalent is running <a class="footnote-reference" href="#id2" id="id1">[*]</a>, so you can see the dojo files in your web browser, and navigate to the URL &#8220;util/doh/runner.html&#8221;.  You should type the full URL into your browser&#8217;s address bar, which might be something like:</p>
<p><code class="docutils literal"><span class="pre">http://localhost/dojo/util/doh/runner.html</span></code></p>
<p>or</p>
<p><code class="docutils literal"><span class="pre">http://localhost:8181/dojo/util/doh/runner.html</span></code></p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[*]</a></td><td><p class="first">If you don&#8217;t yet have a web server running, but you do have Python installed, you can get the tests running in a browser by ensuring you are in the directory that contains the dojo directory, then running:</p>
<p><code class="docutils literal"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">SimpleHTTPServer</span> <span class="pre">&amp;</span></code></p>
<p>or if you have Python 3:</p>
<p><code class="docutils literal"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">http.server</span> <span class="pre">&amp;</span></code></p>
<p>This starts a temporary web server, serving all the files in the current directory.</p>
<p>You can then launch your browser to <a class="reference external" href="http://localhost:8000/util/doh/runner.html">http://localhost:8000/util/doh/runner.html</a> to see the tests running.</p>
<p class="last">Note, however, that some tests will fail because they rely on PHP scripts, which are not supported in this simple web server.</p>
</td></tr>
</tbody>
</table>
<p>What runner.html does is load the DOH test registration and assertion functions, and run some tests.
If no module URL was provided for it to load tests from,
the runner.html will automatically load the file: <em>dojo/tests/module.js</em>.
All that file does is use the dojo module loading system to load in all the test files for core dojo.
It then just executes all the currently registered tests and displays the results in the browser.</p>
<p>When you navigate to this page you should see lots of tests running, and eventually a green bar across the whole screen indicating that they all passed.  If this doesn&#8217;t happen, you may have a version of Dojo that doesn&#8217;t contain DOH, or doesn&#8217;t contain the tests - download a &#8220;-src.zip&#8221; version from <a class="reference external" href="http://download.dojotoolkit.org/">http://download.dojotoolkit.org/</a> and you should be fine.</p>
<p>To run one or more individual tests, rather than all of the Dojo core tests at once, you need an extra URL parameter, like this:</p>
<p><code class="docutils literal"><span class="pre">util/doh/runner.html?test=dojo/tests/date</span></code></p>
<p>This instructs the runner to look in dojo/tests and run the tests inside the file date.js.</p>
</div>
<div class="section" id="testing-your-own-code">
<h4>Testing your own code<a class="headerlink" href="#testing-your-own-code" title="Permalink to this headline">¶</a></h4>
<p>If you want to run your own tests, one option is to put them inside dojo&#8217;s own directory, and run them as in the previous section, but a more normal approach is to put them somewhere else.</p>
<p>If your tests are accessible via a url such as mycode/org/myorg/mymodule/tests/alltests.js on your web browser, you can run them in the DOH runner by navigating to a URL like this:</p>
<p><code class="docutils literal"><span class="pre">util/doh/runner.html?paths=org/myorg,../../../mycode/org/myorg&amp;test=org/myorg/mymodule/tests/alltests</span></code></p>
<p>The <em>paths</em> argument tells Dojo to look in &#8221;../../../mycode/org/myorg&#8221; whenever it seems a reference to a module starting with &#8220;org/myorg&#8221;.  The <em>test</em> argument gives the module name (not the URL) of the test file you want to run.  Note that there is no &#8221;.js&#8221; at the end.</p>
<p>If your code consists of several modules in different locations you can provide all of them within <em>paths</em> by separating them with semi-colons, for example:</p>
<p><code class="docutils literal"><span class="pre">util/doh/runner.html?paths=org/myorg,../../../mycode/org/myorg;com/mycom,../../../x/com/mycom&amp;test=com/mycom/tests</span></code></p>
</div>
</div>
<div class="section" id="on-the-command-line-with-rhino">
<h3><a class="toc-backref" href="#id8">On the command line (with Rhino)</a><a class="headerlink" href="#on-the-command-line-with-rhino" title="Permalink to this headline">¶</a></h3>
<p>Rhino is a JavaScript interpreter, written in Java, that is included with Dojo&#8217;s source distribution.</p>
<p>To run DOH unit tests with Rhino, create a config file something like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">require</span><span class="p">({</span>
    <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;org/myorg&quot;</span> <span class="o">:</span> <span class="s2">&quot;../../../mycode/org/myorg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;com/mycom&quot;</span> <span class="o">:</span> <span class="s2">&quot;../../../x/com/mycom&quot;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>And use a script something like this:</p>
<div class="highlight-bash"><div class="highlight"><pre>java -jar util/shrinksafe/js.jar dojo/dojo.js <span class="nv">baseUrl</span><span class="o">=</span>file:///full/path/to/dojo/dojo <span class="nv">load</span><span class="o">=</span>file://full/path/to/config.js <span class="nv">load</span><span class="o">=</span>doh <span class="nb">test</span><span class="o">=</span>com/mycom/tests
</pre></div>
</div>
<p>And cd into the directory containing the &quot;dijit&quot;, &quot;dojo&quot;, &quot;dojox&quot; and &quot;util&quot; directories before you run it.  You can modify the paths to js.jar and dojo.js to make them absolute if you want to run from elsewhere.</p>
<p>baseUrl should be a URL (not relative path) to the directory that contains dojo.js.</p>
<p>You can also use a module-style path to your config module such as &quot;load=org/myorg/config&quot; if it is accessible that way.</p>
</div>
</div>
<div class="section" id="creating-tests">
<h2><a class="toc-backref" href="#id9">Creating tests</a><a class="headerlink" href="#creating-tests" title="Permalink to this headline">¶</a></h2>
<p>Okay, whee!
The runner.html can be told what test module to load.
So ... what the heck is a test module!?
A test module is nothing more than a file that requires in more test files, calls doh.register() to register tests,
or a combination of both.
Basically a module is nothing more than the file that calls the doh functions to register tests
before D.O.H. executes the test run.
For example, the following code snippet is a test module:</p>
<div class="section" id="example-test-module-simple-test-registration">
<h3><a class="toc-backref" href="#id10">Example Test Module: Simple test registration</a><a class="headerlink" href="#example-test-module-simple-test-registration" title="Permalink to this headline">¶</a></h3>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;doh/runner&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doh</span><span class="p">){</span>

    <span class="nx">doh</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;MyTests&quot;</span><span class="p">,</span> <span class="p">[</span>
      <span class="kd">function</span> <span class="nx">assertTrueTest</span><span class="p">(){</span>
        <span class="nx">doh</span><span class="p">.</span><span class="nx">assertTrue</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">doh</span><span class="p">.</span><span class="nx">assertTrue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">doh</span><span class="p">.</span><span class="nx">assertTrue</span><span class="p">(</span><span class="o">!</span><span class="kc">false</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;thingerTest&quot;</span><span class="p">,</span>
        <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thinger</span><span class="p">();</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">doStuffToInit</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">runTest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="nx">doh</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">blahProp</span><span class="p">);</span>
          <span class="nx">doh</span><span class="p">.</span><span class="nx">assertFalse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">falseProp</span><span class="p">);</span>
          <span class="c1">// ...</span>
        <span class="p">},</span>
        <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="c1">// ...</span>
    <span class="p">]);</span>

<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([&quot;doh/runner&quot;], function(doh){

    doh.register(&quot;MyTests&quot;, [
      function assertTrueTest(){
        doh.assertTrue(true);
        doh.assertTrue(1);
        doh.assertTrue(!false);
      },
      {
        name: &quot;thingerTest&quot;,
        setUp: function(){
          this.thingerToTest = new Thinger();
          this.thingerToTest.doStuffToInit();
        },
        runTest: function(){
          doh.assertEqual(&quot;blah&quot;, this.thingerToTest.blahProp);
          doh.assertFalse(this.thingerToTest.falseProp);
          // ...
        },
        tearDown: function(){
        }
      },
      // ...
    ]);

});</textarea></div></div>
<div class="section" id="example-test-module-module-that-loads-other-modules">
<h3><a class="toc-backref" href="#id11">Example Test Module: Module that loads other modules</a><a class="headerlink" href="#example-test-module-module-that-loads-other-modules" title="Permalink to this headline">¶</a></h3>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span>
    <span class="s2">&quot;my/test/widget/Foo0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;my/test/widget/Foo1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;my/test/widget/Foo2&quot;</span>
<span class="p">]);</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([
    &quot;my/test/widget/Foo0&quot;,
    &quot;my/test/widget/Foo1&quot;,
    &quot;my/test/widget/Foo2&quot;
]);</textarea></div></div>
<div class="section" id="notes-on-registering-tests">
<h3><a class="toc-backref" href="#id12">Notes on Registering Tests</a><a class="headerlink" href="#notes-on-registering-tests" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Names of functions or of test fixtures must be unique per test group.
D.O.H. records results by using the name as a hash key on the results objects.</li>
</ul>
</div>
</div>
<div class="section" id="performance-tests">
<h2><a class="toc-backref" href="#id13">Performance Tests</a><a class="headerlink" href="#performance-tests" title="Permalink to this headline">¶</a></h2>
<p>(Dojo 1.4 and higher)</p>
<p>Unit tests are excellent for testing code behavior and verifying the code works as expected across browsers.
But it's not always what you want to do.
There are times where code may work across browsers, but the code doesn't work fast on all browsers.
It would be great if there was a way to do performance analysis of a function
instead of just doing true/false unit test style testing.</p>
<p>The great news is that as of Dojo 1.4, D.O.H.
has been updated to understand a different type of test fixture (or test registration), the performance test.
Tests registered in this manner work a little differently.
Instead of a single execution of 'runTest' or of the test function,
it will execute that test function many times and then calculate the average cost for a single function run.
This is powerful in determining the general function performance across browsers and identify implementations
that underperform on various browsers.</p>
<p>What a performance fixture does is the following:</p>
<ul class="simple">
<li>The test is 'calibrated'.  This means that the function is executed repeatedly in blocks until the framework
determines that X iterations runs longer than a set time.
The set time is configurable as the 'trialDuration', and the default value is 100ms.
The reason that tests have to be calibrated is that JavaScript doesn't handle timings below 15 ms very well.
So you have to keep repeatedly running the function until a time greater than 15ms passes
and only then can you compute the average runtime of a single function call.
This is a well documented problem with doing JavaScript performance testing and calibration is how D.O.H. deals with it.</li>
<li>Once calibrated, D.O.H. will then go execute a number of trials.
A single trial is a set number of iterations of the test function.
The set number of iterations is what the calibration run determines.
The number of trials you want to run is also configurable as a 'trialIterations' option of your test fixture.</li>
<li>Once all the trial iterations are done, it calculates the basic averages and such.
All this information is stored on the D.O.H. root object 'doh' as attribute 'perfTestResults'.
In fact, you can access the perf test results for a particular function by just doing:
doh.perfTestResults[groupName][functionName].
The structure of the results is an array of entries of the following structure:</li>
</ul>
<div class="highlight"><pre><span class="p">{</span>
   <span class="nx">trial</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span> <span class="c1">// The trial number, 0 .. N trial run</span>
   <span class="nx">testIterations</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span> <span class="c1">// The number of iterations the test function was run for the trial.</span>
   <span class="nx">executionTime</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span> <span class="c1">// The total execution time of the trial, in milliseconds.</span>
   <span class="nx">average</span><span class="o">:</span> <span class="nx">number</span> <span class="c1">// The average time a single iteration of the test function takes.  executionTime/testIterations</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
   trial: number, // The trial number, 0 .. N trial run
   testIterations: number, // The number of iterations the test function was run for the trial.
   executionTime: number, // The total execution time of the trial, in milliseconds.
   average: number // The average time a single iteration of the test function takes.  executionTime/testIterations
}</textarea></div><ul class="simple">
<li>At the end of all the performance tests, if the tests were run in a browser, D.O.H. then calculates statistical information off the run, such as standard deviation, max, min, median, and the like.  It also then plots each trial out using dojox.charting.DataChart (if available).  All this data is displayed on the 'Performance Tests Results' page.  To see this in action, take a look at the <a class="reference external" href="http://archive.dojotoolkit.org/nightly/checkout/dojox/gfx/tests/performance/runTests.html">dojox.gfx performance tests</a> in nightly.</li>
</ul>
<p>You can also look at how to write performance tests by looking at: dojox/gfx/tests/performance/*
in your extract of Dojo 1.4 or development trunk.</p>
</div>
<div class="section" id="reference">
<h2><a class="toc-backref" href="#id14">Reference</a><a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>This section is intended for documentation on the various aspects of D.O.H.,
such as what registration functions there are and what they do, to information on test formats.</p>
<div class="section" id="file-structure">
<h3><a class="toc-backref" href="#id15">File Structure</a><a class="headerlink" href="#file-structure" title="Permalink to this headline">¶</a></h3>
<p>D.O.H. resides in the utils project of the dojo toolkit.
Users can find it explicitly at: <strong>utils/doh</strong>.
The following files structure shows the files important to the usage of the framework:</p>
<ul class="simple">
<li><strong>utils</strong><ul>
<li><strong>doh</strong><ul>
<li><strong>runner.js</strong>:  The main JavaScript file that defines environment agnostic D.O.H APIs.</li>
<li><strong>_browserRunner.js</strong>:  Additional file that augments the definitions in runner.js for a web browser.</li>
<li><strong>_nodeRunner.js</strong>: Additional file that augments the definitions in runner.js for a node.js environment.</li>
<li><strong>_rhinoRunner.js</strong>: Additional file that augments the definitions in runner.js for a Rhino environment.</li>
<li><strong>runner.html</strong>: HTML bootstrap file used to load D.O.H. in the browser and execute tests.</li>
<li><strong>runner.sh</strong>: UNIX shell script to launch D.O.H. under Rhino.</li>
<li><strong>Robot.html</strong>:  HTML file used to bootstrap in the D.O.H Robot for tests that require synthetic user input.</li>
<li><strong>LICENSE</strong>: The license that governs D.O.H.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="registration-functions">
<h3><a class="toc-backref" href="#id16">Registration Functions</a><a class="headerlink" href="#registration-functions" title="Permalink to this headline">¶</a></h3>
<p>These functions are how you register tests within the D.O.H.
framework to run.
The two main functions you will use are <em>doh.register</em> and <em>doh.registerUrl</em>.
The others are provided for completeness.</p>
<div class="section" id="doh-register">
<h4>doh.register(...)<a class="headerlink" href="#doh-register" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>An almost 'magical' function.
The doh.register() method accepts the function signatures of any of the other registration functions and determines the correct underlying function (listed below) to dispatch registration to.
It's the function you'll most commonly use for registering Unit Tests.</div></blockquote>
</div>
<div class="section" id="doh-registertest-group-testfuncorobj">
<h4>doh.registerTest(group, testFuncOrObj)<a class="headerlink" href="#doh-registertest-group-testfuncorobj" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This function registers a test as a member of the group 'group', and the test can either be a simple function definition or a 'Test Fixture', which is an object that defines the run requirements of the test.</div></blockquote>
</div>
<div class="section" id="doh-registertests-group-testfuncorobjarr">
<h4>doh.registerTests(group, testFuncOrObjArr)<a class="headerlink" href="#doh-registertests-group-testfuncorobjarr" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This function registers an array of tests as a member of the group 'group'.
The contents of the array of tests can be an array of simple test functions or an array of 'test fixtures', or a mix of them.</div></blockquote>
</div>
<div class="section" id="doh-registertestns-group-obj">
<h4>doh.registerTestNs(group, obj)<a class="headerlink" href="#doh-registertestns-group-obj" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This function registers an object comprised of functions as a member of the group 'group'.
Note that this function will only add in non-private (functions without an _ at the beginning of the name), as a test function.
If you'd like to use fixtures (setUp(), tearDown(), and runTest()), please use doh.register(), doh.registerTest() or doh.registerTests().</div></blockquote>
</div>
<div class="section" id="doh-registertesturl-url">
<h4>doh.registerTestUrl(url)<a class="headerlink" href="#doh-registertesturl-url" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>This function registers a URL as a location to load tests from.
The URL is used to populate the contents of an iframe, and usually refers to an HTML page that boot-loads D.O.H.
internally for running tests in a segmented iframe.
A good example showing this is the dojo/tests/fx.html.
It loads dojo, doh, and then on dojo load completion calls doh.registerTests().
The D.O.H. instance in the iframe will proxy back the results of the test run to the primary D.O.H. instance.</div></blockquote>
</div>
</div>
<div class="section" id="test-functions">
<h3><a class="toc-backref" href="#id17">Test Functions</a><a class="headerlink" href="#test-functions" title="Permalink to this headline">¶</a></h3>
<p>These functions are the test functions you use inside your unit tests in order to check conditions are report errors if the conditions are not met.
These should be familiar to anyone who has used other test frameworks before, such as JUnit.</p>
<div class="section" id="doh-asserttrue-boolean">
<h4>doh.assertTrue(boolean)<a class="headerlink" href="#doh-asserttrue-boolean" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This function asserts that  particular condition is true.
If the condition is not true, the function will throw an Error object.</p>
<ul class="simple">
<li>Note:  This function is aliased to doh.t();</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="doh-assertfalse-boolean">
<h4>doh.assertFalse(boolean)<a class="headerlink" href="#doh-assertfalse-boolean" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This function asserts that particular condition is false.
If the condition is not false, the function will throw an Error object.</p>
<ul class="simple">
<li>Note:  This function is aliased to doh.f();</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="doh-assertequal-obj1-obj2">
<h4>doh.assertEqual(obj1, obj2)<a class="headerlink" href="#doh-assertequal-obj1-obj2" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This function asserts that the two particular inputs are 'equal to each other, such as 5 == 5, or &quot;Bob&quot; == &quot;Bob&quot;.
The equality is fairly loose, so this is not a good function to use if you want to assert something is equal and of the same data type.
For example, this function will return that 5 == &quot;5&quot; (number 5 equals string 5).
It will also do deep object equality, so beware of object cycles.
If the equality condition is not met, the function will throw and Error object.</p>
<ul class="simple">
<li>Note:  This function is aliased to doh.is();</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="doh-assertnotequal-obj1-obj2">
<h4>doh.assertNotEqual(obj1, obj2)<a class="headerlink" href="#doh-assertnotequal-obj1-obj2" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>This function asserts that the two particular inputs are not 'equal to each other, such as 5 != 6, or &quot;Bob&quot; == &quot;Doe&quot;.
The equality is fairly loose, so this is not a good function to use if you want to assert something is not equal and of the same data type.
It will also do deep object equality/inequality when checking, so beware of object cycles.
If the 'not equal' condition is not met, the function will throw and Error object.</p>
<ul class="simple">
<li>Note:  This function is aliased to doh.isNot();</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="test-structures">
<h3><a class="toc-backref" href="#id18">Test Structures</a><a class="headerlink" href="#test-structures" title="Permalink to this headline">¶</a></h3>
<p>D.O.H. is flexible in how you define tests.
In some respects, perhaps it is too flexible in that it can be confusing which way to define a test or how to define an asynchronous test.
This following section is intended to help explain the various test function formats and when to use them.</p>
<div class="section" id="simple-tests-no-setup-standalone-synchronous-test">
<h4>Simple tests (no setup, standalone, synchronous test)<a class="headerlink" href="#simple-tests-no-setup-standalone-synchronous-test" title="Permalink to this headline">¶</a></h4>
<p>A lot of testing involves checking a widget or JavaScript API or the like and doesn't require any initial setup or teardown to do.
These are simple to define.
You simply write it as a function object.
This object can then be registered through the doh.register() functions.</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">mySimpleTest</span><span class="p">(</span><span class="nx">doh</span><span class="p">){</span>
  <span class="nx">doh</span><span class="p">.</span><span class="nx">assertTrue</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">function mySimpleTest(doh){
  doh.assertTrue(true);
}</textarea></div><p>What the D.O.H. framework will do with this test is wrap it in  a default 'test fixture',
which has null setUp and tearDown functions and a default timeout of 500ms.</p>
</div>
<div class="section" id="simple-tests-no-setup-standalone-asynchronous-test">
<h4>Simple tests (no setup, standalone, asynchronous test)<a class="headerlink" href="#simple-tests-no-setup-standalone-asynchronous-test" title="Permalink to this headline">¶</a></h4>
<p>Simple asynchronous tests are no more complicated to write than the above synchronous test.
You simply write it as a function object that returns a doh.Deferred object.
The test framework detects the return type and knows that if a doh.Deferred is returned, then D.O.H.
should pause here and wait for either the test timeout to fire or the asynchronous test
to invoke either the Deferred to resolve, which is done via the getTestCallback() method.
This object can then be registered through the doh.register() functions.
The example below implements an async test via timeout to demonstrate it.</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">mySimpleAsyncTest</span><span class="p">(</span><span class="nx">doh</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">doh</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">getTestCallback</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">doh</span><span class="p">.</span><span class="nx">assertTrue</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">}),</span> <span class="mi">100</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">function mySimpleAsyncTest(doh){
  var deferred = new doh.Deferred();
  setTimeout(deferred.getTestCallback(function(){
      doh.assertTrue(true);
  }), 100);
  return deferred;
}</textarea></div><p>What the D.O.H. framework will do with this test is wrap it in  a default 'test fixture',
which has null setUp and tearDown functions and a default timeout of 500ms.</p>
</div>
<div class="section" id="test-fixture-setup-standalone-synchronous-test">
<h4>Test Fixture (setup, standalone, synchronous test)<a class="headerlink" href="#test-fixture-setup-standalone-synchronous-test" title="Permalink to this headline">¶</a></h4>
<p>Some testing will require setup and/or teardown, specific pre and post configurations that need to occur ...
or the test requires a different timeout from the default (such as a long-running xhr).
The test fixture format for a test allows for this configuration.
See the following code snippit for an example of a test fixture.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;thingerTest&quot;</span><span class="p">,</span>
  <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Setup to do before runTest.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thinger</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">doStuffToInit</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">runTest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Our test function to run.</span>
    <span class="nx">doh</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">blahProp</span><span class="p">);</span>
    <span class="nx">doh</span><span class="p">.</span><span class="nx">assertFalse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">falseProp</span><span class="p">);</span>
    <span class="c1">// ...</span>
  <span class="p">},</span>
  <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// cleanup to do after runTest.</span>
  <span class="p">},</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">3000</span> <span class="c1">// 3 second timeout.</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
  name: &quot;thingerTest&quot;,
  setUp: function(){
    // Setup to do before runTest.
    this.thingerToTest = new Thinger();
    this.thingerToTest.doStuffToInit();
  },
  runTest: function(){
    // Our test function to run.
    doh.assertEqual(&quot;blah&quot;, this.thingerToTest.blahProp);
    doh.assertFalse(this.thingerToTest.falseProp);
    // ...
  },
  tearDown: function(){
    // cleanup to do after runTest.
  },
  timeout: 3000 // 3 second timeout.
}</textarea></div></div>
<div class="section" id="test-fixture-setup-standalone-asynchronous-test">
<h4>Test Fixture (setup, standalone, asynchronous test)<a class="headerlink" href="#test-fixture-setup-standalone-asynchronous-test" title="Permalink to this headline">¶</a></h4>
<p>Test fixtures can also do asynchronous tests.
All that has to occur for the D.O.H.
framework to recognize that a test fixture is asynchronous is that the runTest method returns a doh.Deferred or
dojo.Deferred.
See below for a fixture that operates asynchronously.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;thingerTest&quot;</span><span class="p">,</span>
  <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Setup to do before runTest.</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Thinger</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">doStuffToInit</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">runTest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Our test function to run.</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">doh</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">getTestCallback</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">doh</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">blahProp</span><span class="p">);</span>
        <span class="nx">doh</span><span class="p">.</span><span class="nx">assertFalse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">thingerToTest</span><span class="p">.</span><span class="nx">falseProp</span><span class="p">);</span>
    <span class="p">}),</span> <span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// cleanup to do after runTest.</span>
  <span class="p">},</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">3000</span> <span class="c1">// 3 second timeout.</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
  name: &quot;thingerTest&quot;,
  setUp: function(){
    // Setup to do before runTest.
    this.thingerToTest = new Thinger();
    this.thingerToTest.doStuffToInit();
  },
  runTest: function(){
    // Our test function to run.
    var deferred = new doh.Deferred();
    setTimeout(deferred.getTestCallback(function(){
        doh.assertEqual(&quot;blah&quot;, this.thingerToTest.blahProp);
        doh.assertFalse(this.thingerToTest.falseProp);
    }), 100);
    return deferred;
  },
  tearDown: function(){
    // cleanup to do after runTest.
  },
  timeout: 3000 // 3 second timeout.
}</textarea></div></div>
<div class="section" id="performance-test-fixture-setup-standalone-synchronous-test">
<h4>Performance Test Fixture (setup, standalone, synchronous test)<a class="headerlink" href="#performance-test-fixture-setup-standalone-synchronous-test" title="Permalink to this headline">¶</a></h4>
<p>(Dojo 1.4 and higher)</p>
<p>Performance test fixtures are just like a regular test fixture, except that it has some extra options developers make use of.
Specifically, it uses 'testType' to mark it as a &quot;perf&quot; test, which instructs the D.O.H.
runner to treat the tests as performance and use the calibrate and execute test runner.
It also allows users to define how long a performance test should run per trial
(we recommend 50ms or more to avoid JS timing issues), how many trials to run,
and how long to delay between each trial to give GC time to the browser.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="nx">testType</span><span class="o">:</span> <span class="s2">&quot;perf&quot;</span><span class="p">,</span> <span class="c1">// Define this as a performance test.  Used to select the runner in D.O.H.</span>
  <span class="nx">trialDuration</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Define that a trial (test run) of the performance test should run minimally for 100ms (however many runs of the function this means.  It is calibrated).</span>
  <span class="nx">trialIterations</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Run 100 trials of the test function.</span>
  <span class="nx">trialDelay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Wait 100MS between each trial to allow for GC, etc.</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;thingerPerformanceTest&quot;</span><span class="p">,</span>
  <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Setup to do before the trial runs of runTest.</span>
  <span class="p">},</span>
  <span class="nx">runTest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Our test function to do performance profiling.</span>
    <span class="nx">myModule</span><span class="p">.</span><span class="nx">doSomePerformanceRelatedThing</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// cleanup to do after all the trials.</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
  testType: &quot;perf&quot;, // Define this as a performance test.  Used to select the runner in D.O.H.
  trialDuration: 100, // Define that a trial (test run) of the performance test should run minimally for 100ms (however many runs of the function this means.  It is calibrated).
  trialIterations: 100, // Run 100 trials of the test function.
  trialDelay: 100, // Wait 100MS between each trial to allow for GC, etc.
  name: &quot;thingerPerformanceTest&quot;,
  setUp: function(){
    // Setup to do before the trial runs of runTest.
  },
  runTest: function(){
    // Our test function to do performance profiling.
    myModule.doSomePerformanceRelatedThing();
  },
  tearDown: function(){
    // cleanup to do after all the trials.
  }
}</textarea></div></div>
<div class="section" id="performance-test-fixture-setup-standalone-asynchronous-test">
<h4>Performance Test Fixture (setup, standalone, asynchronous test)<a class="headerlink" href="#performance-test-fixture-setup-standalone-asynchronous-test" title="Permalink to this headline">¶</a></h4>
<p>(Dojo 1.4 and higher)</p>
<p>Async performance test fixtures are just like synchronous performance test fixtures.
The only difference is that these return doh.Deferreds to tell the runner framework to treat the test as async.
Note:  Performance profiling asynchronous operations will not always provide useful information.
By the nature of being async means its performance profile will likely vary considerably.
The below example demonstrates an async performance fixture through the use of setTimeout.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="nx">testType</span><span class="o">:</span> <span class="s2">&quot;perf&quot;</span><span class="p">,</span> <span class="c1">// Define this as a performance test.  Used to select the runner in D.O.H.</span>
  <span class="nx">trialDuration</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Define that a trial (test run) of the performance test should run minimally for 100ms (however many runs of the function this means.  It is calibrated).</span>
  <span class="nx">trialIterations</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Run 100 trials of the test function.</span>
  <span class="nx">trialDelay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// Wait 100MS between each trial to allow for GC, etc.</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;thingerAsyncPerfTest&quot;</span><span class="p">,</span>
  <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Setup to do before runTest.</span>
  <span class="p">},</span>
  <span class="nx">runTest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Our test function to run.</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">doh</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">getTestCallback</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">myModule</span><span class="p">.</span><span class="nx">doSomePerformanceRelatedThing</span><span class="p">();</span>
    <span class="p">}),</span> <span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="p">},</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">3000</span> <span class="c1">// 3 second timeout.</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
  testType: &quot;perf&quot;, // Define this as a performance test.  Used to select the runner in D.O.H.
  trialDuration: 100, // Define that a trial (test run) of the performance test should run minimally for 100ms (however many runs of the function this means.  It is calibrated).
  trialIterations: 100, // Run 100 trials of the test function.
  trialDelay: 100, // Wait 100MS between each trial to allow for GC, etc.
  name: &quot;thingerAsyncPerfTest&quot;,
  setUp: function(){
    // Setup to do before runTest.
  },
  runTest: function(){
    // Our test function to run.
    var deferred = new doh.Deferred();
    setTimeout(deferred.getTestCallback(function(){
        myModule.doSomePerformanceRelatedThing();
    }), 100);
    return deferred;
  },
  tearDown: function(){
  },
  timeout: 3000 // 3 second timeout.
}</textarea></div></div>
</div>
</div>
<div class="section" id="see-also">
<h2><a class="toc-backref" href="#id19">See also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The numerous unit tests in dojo itself!  For example: dojo/tests/*, dijit/tests/module.js, dojox/*/ tests/*, and so on.</li>
<li><a class="reference external" href="http://www.ibm.com/developerworks/web/library/wa-aj-doh/index.html">D.O.H tutorial by IBM</a>  <em>(Has example code)</em></li>
<li><a class="reference external" href="http://www.artificialworlds.net/blog/2012/10/09/running-dojo-doh-unit-tests-on-the-command-line-with-rhino/">Running Dojo 1.7+ DOH unit tests on the command line with Rhino</a> - A fuller explanation of running DOH tests using Rhino</li>
</ul>
</div>
</div>


      </div>
    </div>
      <div class="clearer"></div>
    </div>

  <div class="row">
    <div class="medium-9 columns offset-3">
        <a href="https://docs.google.com/spreadsheet/viewform?hl=en_US&formkey=dFlDcHEyaHMwbEd4MFBObkNrX0E1MFE6MQ&entry_0=http%3A%2F%2Fdojotoolkit.org%2Freference-guide%2F1.10%2F">Error in the documentation? Can’t find what you are looking for? Let us know!</a>
        <div class="footer">
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-22088032-1', 'auto');
		ga('send', 'pageview');

	</script>
</div>
    </div>
  </div>
  
  </body>
</html>