<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dojox.form.FileUploader &mdash; The Dojo Toolkit - Reference Guide</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.10.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>

    <link rel="stylesheet" href="../../../../../css/guide.css">
    <script type="text/javascript">
      dojoConfig = {
        async: true
      };
    </script>
    <script src="../../../scripts/dojo/dojo/dojo.js"></script>
    <script src="../../../../../scripts/guide/docs/guide.js"></script>
    <link rel="stylesheet" href="../../../../../scripts/dojo/dijit/themes/claro/claro.css">

  </head>
  <body role="document">
  

    <div class="document">

  <div class="nav">
	<div class="row">
		<div class="small-3 columns">
			<a href="/" class="navLogo"><span>Dojo</span></a>
		</div>
		<div class="small-9 columns text-right">
			<div class="mobileMenuToggle" data-menu-toggle></div>
			<div class="menu">
				<div class="mobileHeader">Menu</div>
				<ul class="inline-list menuItems right">
					<li><a href="">Get Dojo</a></li>
					<li><a href="/documentation/">Docs</a></li>
					<li><a href="">Help &amp; Support</a></li>
					<li><a href="">Blog</a></li>
					<li><a href="">Get Involved</a></li>
				</ul>
			</div>
		</div>
	</div>
</div>
  <main class="refguide">
    <div class="row">

      <div class="medium-3 columns sideNav">
        <h4>Reference Guide</h4>
        <div id="dtkVersion">
          <label for="refver">Dojo Version</label>
          <select id="refver" name="refver">
            <option value="1.6">1.6</option>
            <option value="1.7">1.7</option>
            <option value="1.8">1.8</option>
            <option value="1.9">1.9</option>
            <option value="1.10" selected="selected">1.10</option>
          </select>
        </div>
        <ul>
          <li><a href="../../index.html">Startpage</a></li>
          <li><a href="../../dojo/index.html">Dojo</a></li>
          <li><a href="../../dijit/index.html">Dijit</a></li>
          <li><a href="../index.html">DojoX</a></li>
        </ul>
        <ul>
<li><a class="reference internal" href="#">dojox.form.FileUploader</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#cdn-note">CDN Note</a></li>
<li><a class="reference internal" href="#dojo-version-1-2-x">Dojo Version 1.2.x</a></li>
<li><a class="reference internal" href="#dojo-version-1-3">Dojo Version 1.3</a></li>
<li><a class="reference internal" href="#dojo-version-1-3-2">Dojo Version 1.3.2</a></li>
<li><a class="reference internal" href="#dojo-version-1-4-0">Dojo Version 1.4.0</a></li>
<li><a class="reference internal" href="#dojo-version-1-5-0">Dojo Version 1.5.0</a></li>
<li><a class="reference internal" href="#dojo-version-1-6-0">Dojo Version 1.6.0</a></li>
</ul>
</li>
<li><a class="reference internal" href="#important-notes">IMPORTANT NOTES</a></li>
<li><a class="reference internal" href="#updating-your-release">Updating Your Release</a></li>
<li><a class="reference internal" href="#fileuploader-functionality-1-3-2-1-5">FileUploader Functionality 1.3.2 - 1.5</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li><a class="reference internal" href="#new-features">New Features</a></li>
<li><a class="reference internal" href="#version-1-3">Version 1.3</a></li>
<li><a class="reference internal" href="#advanced-parameters">Advanced Parameters</a></li>
<li><a class="reference internal" href="#id2">Dependencies</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-side">Server Side</a><ul>
<li><a class="reference internal" href="#server-side-code-php">Server Side Code PHP</a></li>
<li><a class="reference internal" href="#server-side-return-data">Server Side Return Data</a></li>
<li><a class="reference internal" href="#https-issues">HTTPS Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#demos">Demos</a></li>
</ul>
</li>
</ul>

        

            <div id="searchbox" style="display: none">
                <h3>Quick search</h3>
                <form class="search" action="../../search.html" method="get">
                    <input type="text" name="q" size="18" />
                    <input type="submit" value="Go" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                 </form>
                 <p class="searchtip" style="font-size: 90%">
                     Enter search terms or a module, class or function name.
                 </p>
            </div>
      </div>
      <div class="medium-9 columns content">
        
  <div class="section" id="dojox-form-fileuploader">
<span id="id1"></span><h1><a class="toc-backref" href="#id3">dojox.form.FileUploader</a><a class="headerlink" href="#dojox-form-fileuploader" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Project owner:</th><td class="field-body">Mike Wilcox</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Mike Wilcox</td>
</tr>
<tr class="field-odd field"><th class="field-name">since:</th><td class="field-body">1.1</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dojox-form-fileuploader" id="id3">dojox.form.FileUploader</a><ul>
<li><a class="reference internal" href="#usage" id="id4">Usage</a><ul>
<li><a class="reference internal" href="#cdn-note" id="id5">CDN Note</a></li>
<li><a class="reference internal" href="#dojo-version-1-2-x" id="id6">Dojo Version 1.2.x</a></li>
<li><a class="reference internal" href="#dojo-version-1-3" id="id7">Dojo Version 1.3</a></li>
<li><a class="reference internal" href="#dojo-version-1-3-2" id="id8">Dojo Version 1.3.2</a></li>
<li><a class="reference internal" href="#dojo-version-1-4-0" id="id9">Dojo Version 1.4.0</a></li>
<li><a class="reference internal" href="#dojo-version-1-5-0" id="id10">Dojo Version 1.5.0</a></li>
<li><a class="reference internal" href="#dojo-version-1-6-0" id="id11">Dojo Version 1.6.0</a></li>
</ul>
</li>
<li><a class="reference internal" href="#important-notes" id="id12">IMPORTANT NOTES</a></li>
<li><a class="reference internal" href="#updating-your-release" id="id13">Updating Your Release</a></li>
<li><a class="reference internal" href="#fileuploader-functionality-1-3-2-1-5" id="id14">FileUploader Functionality 1.3.2 - 1.5</a><ul>
<li><a class="reference internal" href="#setup" id="id15">Setup</a></li>
<li><a class="reference internal" href="#dependencies" id="id16">Dependencies</a></li>
<li><a class="reference internal" href="#new-features" id="id17">New Features</a></li>
<li><a class="reference internal" href="#version-1-3" id="id18">Version 1.3</a></li>
<li><a class="reference internal" href="#advanced-parameters" id="id19">Advanced Parameters</a></li>
<li><a class="reference internal" href="#id2" id="id20">Dependencies</a></li>
<li><a class="reference internal" href="#debugging" id="id21">Debugging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-side" id="id22">Server Side</a><ul>
<li><a class="reference internal" href="#server-side-code-php" id="id23">Server Side Code PHP</a></li>
<li><a class="reference internal" href="#server-side-return-data" id="id24">Server Side Return Data</a></li>
<li><a class="reference internal" href="#https-issues" id="id25">HTTPS Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#demos" id="id26">Demos</a></li>
</ul>
</li>
</ul>
</div>
<p>Handles multiple file uploading to a server. DEPRECATED: dojox.form.FileUploader is no longer supported and will be removed in 2.0. Suggested that you use <a class="reference internal" href="Uploader.html#dojox-form-uploader"><span>dojox.form.Uploader</span></a> instead.</p>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cdn-note">
<h3><a class="toc-backref" href="#id5">CDN Note</a><a class="headerlink" href="#cdn-note" title="Permalink to this headline">¶</a></h3>
<p>FileUploader does work with the Google and AOL CDNs, but because of cross domain issues, you need to run the SWF locally, and point to its location with dojoConfig.uploaderPath.</p>
</div>
<div class="section" id="dojo-version-1-2-x">
<h3><a class="toc-backref" href="#id6">Dojo Version 1.2.x</a><a class="headerlink" href="#dojo-version-1-2-x" title="Permalink to this headline">¶</a></h3>
<p>The FileUploader version 1.1 and 1.2 is no longer supported. FileUploader 1.2 programmatically called the Flash browse() method which Adobe soon after removed for security reasons.</p>
</div>
<div class="section" id="dojo-version-1-3">
<h3><a class="toc-backref" href="#id7">Dojo Version 1.3</a><a class="headerlink" href="#dojo-version-1-3" title="Permalink to this headline">¶</a></h3>
<p>This version is supported but has limitations. It floats the SWF over the styled button, so the CSS is tricky and not always 100% accurate. And this will not work in many cases where the button is in scrolling content, specifically Windows and Linux Firefox.</p>
</div>
<div class="section" id="dojo-version-1-3-2">
<h3><a class="toc-backref" href="#id8">Dojo Version 1.3.2</a><a class="headerlink" href="#dojo-version-1-3-2" title="Permalink to this headline">¶</a></h3>
<p>This version is a major upgrade from 1.3, makes CSS placement easier and fixes the scrolling bug. However there is an IE8 bug that was not caught at the time of release. This bug can be patched using the instructions found in the Trac ticket:</p>
<p><a class="reference external" href="http://bugs.dojotoolkit.org/ticket/9615">http://bugs.dojotoolkit.org/ticket/9615</a></p>
<p>Another bug found is uploading multiple files more than once causes onComplete to fire on every file. It should only fire after all files have uploaded. The fix for this is to use the SWF from the trunk (1.4) in the 1.3.2 release.</p>
<p><a class="reference external" href="http://bugs.dojotoolkit.org/ticket/9646">http://bugs.dojotoolkit.org/ticket/9646</a></p>
</div>
<div class="section" id="dojo-version-1-4-0">
<h3><a class="toc-backref" href="#id9">Dojo Version 1.4.0</a><a class="headerlink" href="#dojo-version-1-4-0" title="Permalink to this headline">¶</a></h3>
<p>This version has some serious upgrades, including a more robust upload system that has been tested to upload 500 files and 500 megs. This version also fixes several bugs including the ability to display the uploader in a Dialog.</p>
</div>
<div class="section" id="dojo-version-1-5-0">
<h3><a class="toc-backref" href="#id10">Dojo Version 1.5.0</a><a class="headerlink" href="#dojo-version-1-5-0" title="Permalink to this headline">¶</a></h3>
<p>This version adds the ability to use the uploader in a TabContainer. However, see the next section.</p>
</div>
<div class="section" id="dojo-version-1-6-0">
<h3><a class="toc-backref" href="#id11">Dojo Version 1.6.0</a><a class="headerlink" href="#dojo-version-1-6-0" title="Permalink to this headline">¶</a></h3>
<p>dojox.form.FileUploader is now deprecated. Use <a class="reference internal" href="Uploader.html#dojox-form-uploader"><span>dojox.form.Uploader</span></a> instead.</p>
</div>
</div>
<div class="section" id="important-notes">
<h2><a class="toc-backref" href="#id12">IMPORTANT NOTES</a><a class="headerlink" href="#important-notes" title="Permalink to this headline">¶</a></h2>
<p>There is a serious limitation in the Flash version for Firefox and Safari in TabContainers. When a node in those browsers is hidden (or essentially repainted which can mean other style applications) the SWF is reloaded. This means that if you browse for a file but don&#8217;t upload upload it, change the tab and return, the files will no longer be in the FileUploader. This problem can be seen when tabbing between Tab 1 and Tab 2 and observing the console logs and you will see the SWF reinitializes. This problem does not exist in Internet Explorer. The HTML version of the Uploader should also work fine.</p>
<p>See form/tests/test_FileUploaderTabs.html for the workaround. It floats a div above the tab container and moves it on and off screen as the tab is toggled.</p>
<p>While the FileUploader instantiates like a widget, it has limitations due to the fact that it has to manage a Flash plugin. Before it is built, it inspects the DOM and checks style information. Due to this process there needs to be a node to inspect, so dojo 1.4 functionality like:</p>
<p><em>var f = new dojox.form.FileUploader(props).placeAt(anything);</em></p>
<p>...will not work. There may also be problems with placing it in other widgets unless it displays right away, although as of 1.5 these problems have mostly been worked out.</p>
<p>If you need to manually manage when an initially hidden flash-based file uploader is shown and have it created properly see this ticket: <a class="reference external" href="http://bugs.dojotoolkit.org/ticket/10920">http://bugs.dojotoolkit.org/ticket/10920</a></p>
<p>Another limitation with using Flash is passing data back and forth. There is a problem with passing variable names with illegal characters, like:</p>
<p><em>{form[&#8220;my-var&#8221;]: &#8220;foo&#8221;)</em></p>
<p>Currently the only workaround is to <em>don&#8217;t do that</em>.</p>
</div>
<div class="section" id="updating-your-release">
<h2><a class="toc-backref" href="#id13">Updating Your Release</a><a class="headerlink" href="#updating-your-release" title="Permalink to this headline">¶</a></h2>
<p>I often suggest to people who are not able to use the 1.3.2 or trunk version of Dojo to copy over the latest uploader files. The involved files would be:</p>
<blockquote>
<div><ul class="simple">
<li>dojox/form/FileUploader.js</li>
<li>dojox/form/resources/uploader.swf</li>
<li>dojox/form/resources/FileUploader.css</li>
<li>dojox/embed/flashVars.js</li>
<li>dojox/embed/Flash.js</li>
</ul>
</div></blockquote>
<p>and optionally:</p>
<blockquote>
<div><ul class="simple">
<li>dojox/form/resources/UploadFile.php</li>
<li>dojox/form/resources/cLOG.php</li>
</ul>
</div></blockquote>
<p>Note that if you are moving these files into Dojo 1.2 or less, you will have to change some of the code in the FileUploader to not use the 1.3 html method dojo.destroy() and replace it with the previous version of dojo._destroyElement()</p>
</div>
<div class="section" id="fileuploader-functionality-1-3-2-1-5">
<h2><a class="toc-backref" href="#id14">FileUploader Functionality 1.3.2 - 1.5</a><a class="headerlink" href="#fileuploader-functionality-1-3-2-1-5" title="Permalink to this headline">¶</a></h2>
<p>FileUploader is now a widget and <strong>DOES</strong> create a button. You do not have to pass a button in. Passing a button is still supported until version 1.5 to maintain backwards compatibility, but it is not recommended. In a majority of cases, you can create your uploader like any other widget.</p>
<div class="section" id="setup">
<h3><a class="toc-backref" href="#id15">Setup</a><a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>The button styles are now recreated in Flash, so there is no longer an invisible Flash movie with <em>wmode=transparent</em>. This way the Flash button is actually placed inline with the DOM, not floating above it and constantly resetting its position. The &#8220;Windows Firefox clickable bug&#8221; should be fixed (and hopefully some Linux problems).</p>
<p>The HTML button is created in a new way and it is now inline as is the Flash button. Styling is much easier and more versatile.</p>
<p>The process is to create a typical HTML button, with either a button, input, div, or span tag. Button tags work the best. Style the button how you would like it to look in CSS. Then create another class that will append to the class chain to style the button in its hover state. Follow the same procedure for active state (press) and disabled state. Assign the normal class to your button and make the widget either programmatically or with markup.</p>
<p>A basic example follows:</p>
<div class="highlight"><pre><span class="nc">.uploadBtn</span><span class="p">{</span>
    <span class="k">border</span><span class="o">:</span><span class="m">1px</span> <span class="k">solid</span> <span class="m">#333333</span><span class="p">;</span>
    <span class="k">background</span><span class="o">:</span><span class="sx">url(buttonEnabled.png)</span> <span class="m">#d0d0d0</span> <span class="k">repeat-x</span> <span class="k">scroll</span> <span class="m">0px</span> <span class="k">top</span><span class="p">;</span>
    <span class="k">font-size</span><span class="o">:</span><span class="m">14px</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span><span class="m">201px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span><span class="m">30px</span><span class="p">;</span>
    <span class="k">vertical-align</span><span class="o">:</span><span class="k">middle</span><span class="p">;</span> <span class="c">/* emulates a &lt;button&gt; if node is not */</span>
    <span class="k">text-align</span><span class="o">:</span><span class="k">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.uploadHover</span><span class="p">{</span>
    <span class="k">background-image</span><span class="o">:</span><span class="sx">url(buttonHover.png)</span><span class="p">;</span>
    <span class="k">cursor</span><span class="o">:</span><span class="k">pointer</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="o">:</span><span class="k">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.uploadPress</span><span class="p">{</span>
    <span class="k">background-image</span><span class="o">:</span><span class="sx">url(buttonActive.png)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.uploadDisabled</span><span class="p">{</span>
    <span class="k">background-image</span><span class="o">:</span><span class="k">none</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span><span class="m">#666</span><span class="p">;</span>
    <span class="k">color</span><span class="o">:</span><span class="m">#999</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span><span class="m">1px</span> <span class="k">solid</span> <span class="m">#999</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="css"><textarea style="display:none">.uploadBtn{
    border:1px solid #333333;
    background:url(buttonEnabled.png) #d0d0d0 repeat-x scroll 0px top;
    font-size:14px;
    width:201px;
    height:30px;
    vertical-align:middle; /* emulates a &lt;button&gt; if node is not */
    text-align:center;
}
.uploadHover{
    background-image:url(buttonHover.png);
    cursor:pointer;
    font-weight:bold;
}

.uploadPress{
    background-image:url(buttonActive.png);
}
.uploadDisabled{
    background-image:none;
    background-color:#666;
    color:#999;
    border:1px solid #999;
}</textarea></div><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;btn&quot;</span> <span class="na">class=</span><span class="s">&quot;uploadBtn&quot;</span><span class="nt">&gt;</span>Select Files<span class="nt">&lt;/div&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;div id=&quot;btn&quot; class=&quot;uploadBtn&quot;&gt;Select Files&lt;/div&gt;</textarea></div><div class="highlight"><pre><span class="kd">var</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dojox</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FileUploader</span><span class="p">({</span>
    <span class="nx">hoverClass</span><span class="o">:</span><span class="s2">&quot;uploadHover&quot;</span><span class="p">,</span>
    <span class="nx">activeClass</span><span class="o">:</span><span class="s2">&quot;uploadBtn&quot;</span><span class="p">,</span>
    <span class="nx">pressClass</span><span class="o">:</span><span class="s2">&quot;uploadPress&quot;</span><span class="p">,</span>
    <span class="nx">disabledClass</span><span class="o">:</span><span class="s2">&quot;uploadDisable&quot;</span><span class="p">,</span>
    <span class="nx">uploadUrl</span><span class="o">:</span><span class="nx">pathToUploadServerScript</span>
<span class="p">},</span> <span class="s2">&quot;btn&quot;</span><span class="p">);</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var uploader = new dojox.form.FileUploader({
    hoverClass:&quot;uploadHover&quot;,
    activeClass:&quot;uploadBtn&quot;,
    pressClass:&quot;uploadPress&quot;,
    disabledClass:&quot;uploadDisable&quot;,
    uploadUrl:pathToUploadServerScript
}, &quot;btn&quot;);</textarea></div><p>Or, using the same CSS, create it as markup:</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;uploadBtn&quot;</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dojox.form.FileUploader&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;hoverClass:&#39;uploadHover&#39;, pressClass:&#39;uploadPress&#39;,</span>
<span class="s">     activeClass:&#39;uploadBtn&#39;, disabledClass:&#39;uploadDisable&#39;, uploadUrl:&#39;../serverpage.php&#39;&quot;</span><span class="nt">&gt;</span>Select Files<span class="nt">&lt;/div&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;div class=&quot;uploadBtn&quot; data-dojo-type=&quot;dojox.form.FileUploader&quot; data-dojo-props=&quot;hoverClass:'uploadHover', pressClass:'uploadPress',
     activeClass:'uploadBtn', disabledClass:'uploadDisable', uploadUrl:'../serverpage.php'&quot;&gt;Select Files&lt;/div&gt;</textarea></div></div>
<div class="section" id="dependencies">
<h3><a class="toc-backref" href="#id16">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>FileUploader no longer uses FileInput.css. It now uses FileUploader.css. See requires for JavaScript dependencies.</p>
</div>
<div class="section" id="new-features">
<h3><a class="toc-backref" href="#id17">New Features</a><a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Disabled: Can be toggled with widget.set(&#8220;disabled&#8221;, true|false)</li>
<li>Submit: A convenience method has been added for if the uploader is in a form. Instead of submitting the form, call uploader.submit(theForm), and the Uploader will handle all of the form values and post the data.</li>
<li>Selected List: If passing the ID of a container, the Uploaders will populate it with the selected files.</li>
<li>Deleting Files: You can now delete pending files.</li>
<li>Progress Built in: showProgress:true will change the button to a progress bar on upload.</li>
<li>Progress Attach: Passing progressWidgetId will tell the Uploader of a progress widget. If the Progress widget is initially hidden, it will change to visible and then restored after upload.</li>
<li>A11Y: The Flash button can be accessed with the TAB key. (The HTML cannot due to browser limitations)</li>
<li>Deferred Uploading: (Flash only) throttles the upload to one file at a time</li>
</ul>
<p>Changed in 1.4: deferredUploading is now mandatory to prevent errors in Firefox and Safari. It accepts a number and the idea is you can upload more than one file in parallel, though my tests have shown it always does one at a time anyway. This change makes the upload a little slower, but now it is much more robust and can handle uploads of 500 files or more without crashing the browser.</p>
<p>There are two new tests added to DojoX: <em>test_FileUploaderCSS.html</em> and <em>test_FileUploaderForm.html</em>. The form test will show how to implement most of the new features. The CSS test will show different methods of styling the Uploader.</p>
<p><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderForm.html">http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderForm.html</a></p>
<p><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderCSS.html">http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderCSS.html</a></p>
<p>Continue with the 1.3 instructions for other information that still applies to implementing the FileUploader.</p>
</div>
<div class="section" id="version-1-3">
<h3><a class="toc-backref" href="#id18">Version 1.3</a><a class="headerlink" href="#version-1-3" title="Permalink to this headline">¶</a></h3>
<p>Version 1.3 does <strong>NOT</strong> create a button - it transforms an existing button into an uploader. This can be used for toolbar buttons for example. Because of this, it only works programmatically, it does not work in markup. Use the other other DojoX FileInput files for markup solutions.</p>
<p>FileUploader will detect if the correct version of Flash Player is available, and if so, a transparent SWF is laid over the top of the original (referred to as the &#8216;fake&#8217;) button. If not available, a traditional fileInput button with opacity set to zero is laid over the fake button.</p>
<p>A basic example follows:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dojox</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FileUploader</span><span class="p">({</span>
    <span class="nx">button</span><span class="o">:</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myFakeButton&quot;</span><span class="p">),</span>
    <span class="nx">uploadUrl</span><span class="o">:</span><span class="nx">uploadUrl</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var uploader = new dojox.form.FileUploader({
    button:dijit.byId(&quot;myFakeButton&quot;),
    uploadUrl:uploadUrl,
});</textarea></div><p>The example has doesn&#8217;t show <em>selectMultipleFiles</em>, but it defaults to true. Setting it to false restricts the user to one file selection. Multiple files are also supported in the HTML version, although only one file can be selected at a time. But after the files are selected, they will all be uploaded at once.</p>
<p>The <em>uploadUrl</em> property is the location of the server side script. Note that this URL needs to be relative to the SWF, not to the HTML page, nor to dojo.js. It&#8217;s recommended that an absolute URL is used if possible. FlashUpload will try to &#8220;normalize&#8221; relative URLs and point them to the SWF.</p>
<p>Use <em>dojo.connect</em> to connect to the <em>onChange</em>, <em>onProgress</em> and <em>onComplete</em> methods:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">uploader</span><span class="p">,</span> <span class="s2">&quot;onChange&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">){</span>
    <span class="nx">dojo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myTextarea&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">size</span><span class="o">*</span><span class="p">.</span><span class="mi">001</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;kb \n&quot;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">uploader</span><span class="p">,</span> <span class="s2">&quot;onProgress&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">){</span>
    <span class="nx">dojo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myTextarea&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">+=</span> <span class="s2">&quot;onProgress: (&quot;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">percent</span><span class="o">+</span><span class="s2">&quot;%) &quot;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; \n&quot;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">uploader</span><span class="p">,</span> <span class="s2">&quot;onComplete&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">){</span>
    <span class="nx">dojo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dataArray</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span>
        <span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myTextarea&quot;</span><span class="p">).</span><span class="nx">value</span> <span class="o">+=</span> <span class="s2">&quot;onComplete: &quot;</span><span class="o">+</span><span class="nx">d</span><span class="p">.</span><span class="nx">file</span><span class="o">+</span><span class="s2">&quot; \n&quot;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.connect(uploader, &quot;onChange&quot;, function(dataArray){
    dojo.forEach(dataArray, function(data){
        dojo.byId(&quot;myTextarea&quot;).value += data.name+&quot; &quot;+Math.ceil(data.size*.001)+&quot;kb \n&quot;;
    });
});
dojo.connect(uploader, &quot;onProgress&quot;, function(dataArray){
    dojo.forEach(dataArray, function(data){
        dojo.byId(&quot;myTextarea&quot;).value += &quot;onProgress: (&quot;+data.percent+&quot;%) &quot;+data.name+&quot; \n&quot;;
    });
});
dojo.connect(uploader, &quot;onComplete&quot;, function(dataArray){
    dojo.forEach(dataArray, function(d){
        dojo.byId(&quot;myTextarea&quot;).value += &quot;onComplete: &quot;+d.file+&quot; \n&quot;;
    });
});</textarea></div><p>Use <em>upload</em> to initiate the upload after files have been selected. Or set <em>uploadOnChange</em> to true to initiate upload automatically after the selection.</p>
<p>Note that the &#8220;dataArray&#8221; param above is always an array, even if selectMultipleFiles is set to false.</p>
<p>Updated: Be careful not to construct the connect so that it sends a mouse event to the upload method (as this example used to do). The upload method expects no arguments or one argument to use as postData. The mouse event will be treated as postData and throw an error. This is fixed in the trunk but exists in 1.32.</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myUploadButton&quot;</span><span class="p">),</span> <span class="s2">&quot;onClick&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">uploader</span><span class="p">.</span><span class="nx">upload</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.connect(dijit.byId(&quot;myUploadButton&quot;), &quot;onClick&quot;, function(){
    uploader.upload();
});</textarea></div></div>
<div class="section" id="advanced-parameters">
<h3><a class="toc-backref" href="#id19">Advanced Parameters</a><a class="headerlink" href="#advanced-parameters" title="Permalink to this headline">¶</a></h3>
<p>The FileUploader has many advanced properties to handle most situations.</p>
<p><strong>fileMask</strong>: An array, or an array of arrays. Restrict file selection to certain file types Empty array defaults to &#8220;All Files&#8221;. NOTE: MacType is not supported, as it does not work very well. fileMask will work on a Mac, but differently than Windows.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">fileMask</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Images&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpg;*.jpeg;*.gif;*.png&quot;</span><span class="p">]</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">fileMask</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Jpeg File&quot;</span><span class="p">,</span>  <span class="s2">&quot;*.jpg;*.jpeg&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;GIF File&quot;</span><span class="p">,</span>   <span class="s2">&quot;*.gif&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;PNG File&quot;</span><span class="p">,</span>   <span class="s2">&quot;*.png&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;All Images&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpg;*.jpeg;*.gif;*.png&quot;</span><span class="p">],</span>
<span class="p">];</span>
<span class="kd">var</span> <span class="nx">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dojox</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FileUploader</span><span class="p">({</span>
    <span class="nx">button</span><span class="o">:</span><span class="nx">dijit</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;myFakeButton&quot;</span><span class="p">),</span>
    <span class="nx">uploadUrl</span><span class="o">:</span><span class="nx">uploadUrl</span><span class="p">,</span>
    <span class="nx">fileMask</span><span class="o">:</span><span class="nx">fileMask</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var fileMask = [&quot;Images&quot;, &quot;*.jpg;*.jpeg;*.gif;*.png&quot;]
// or
var fileMask = [
    [&quot;Jpeg File&quot;,  &quot;*.jpg;*.jpeg&quot;],
    [&quot;GIF File&quot;,   &quot;*.gif&quot;],
    [&quot;PNG File&quot;,   &quot;*.png&quot;],
    [&quot;All Images&quot;, &quot;*.jpg;*.jpeg;*.gif;*.png&quot;],
];
var uploader = new dojox.form.FileUploader({
    button:dijit.byId(&quot;myFakeButton&quot;),
    uploadUrl:uploadUrl,
    fileMask:fileMask
});</textarea></div><p><strong>force</strong>: You can use either HTML (force=&#8221;html&#8221;) or Flash only, with this parameter. If force=&#8221;flash&#8221; and the user does not have Flash installed, they will be prompted to install the plugin. &#8220;flash&#8221; forces Flash Uploader. Defaults to an empty string (force=&#8221;&#8221;) which checks for the availability of the proper Flash player (Flash 9 or higher).</p>
<p><strong>postData</strong>: The data that will be sent via POST to the server along with the uploaded files. This data object can bet set on instantiation, and the data will be sent to the server with each file on every upload. You can also pass postData in the upload method as an object argument which can be different with each upload.</p>
<p>Note: as of 1.4.0 there is a bug: <a class="reference external" href="http://bugs.dojotoolkit.org/ticket/10559">http://bugs.dojotoolkit.org/ticket/10559</a> where postData is not being sent for flash based uploaders where uploadOnChange is also true. This is fixed in 1.5.</p>
<p><strong>Returned postData</strong>: Post data is regurgitated to the uploader in the tests. Your case may be different. The SWF returns postdata in an <em>additionalParams</em> object, and it is in this object in which the postdata can be found in the onComplete object. The reason for this was originally to get around AS3 issues, but it turns out to be a good system, as it prevents post data variables from overwriting standard variables such as &#8216;name&#8217; or &#8216;file&#8217;.</p>
<p><strong>htmlFieldName</strong>: The name of the field of the fileInput that the server is expecting. See &#8220;Server Side Code&#8221; below.</p>
<p><strong>flashFieldName</strong>: The name of the field of the flash uploaded files that the server is expecting. See &#8220;Server Side Code&#8221; below.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id20">Dependencies</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>dojox.html.styles to create dynamic CSS for an IE workaround.
dojo.io.iframe for the HTML POST upload.
dojox.embed.Flash for embedding the SWF in the page.
dojox/form/resources/FileInput.css for some fileInput styling.</p>
</div>
<div class="section" id="debugging">
<h3><a class="toc-backref" href="#id21">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>Because of the complex nature of the FileUploader code (or more accurately, the hack!). It&#8217;s often necessary to do some debugging to test if something is working properly. The following parameters assist with this:</p>
<p><strong>isDebug</strong>: Unlike most Dojo code, the logging has been left in the FileUploader, but is disabled by default. isDebug=true will turn on the log messages for inspection. This also passes to the SWF which will output messages of what&#8217;s happening in there.</p>
<p><strong>devMode</strong>: Changing this parameter to true will set the opacity of the HTML upload button to 100% and remove transparency from the Flash upload button. This helps to determine of the button is being positioned correctly.</p>
</div>
</div>
<div class="section" id="server-side">
<h2><a class="toc-backref" href="#id22">Server Side</a><a class="headerlink" href="#server-side" title="Permalink to this headline">¶</a></h2>
<p>The transfer of data happens through Flash and so the you will not be able to inspect the data in Firebug. It&#8217;s recommended to use Charles or Fiddler if you wish to inspect the transfer.</p>
<p><a class="reference external" href="http://www.charlesproxy.com/">http://www.charlesproxy.com/</a></p>
<p><a class="reference external" href="http://www.fiddler2.com/fiddler2/">http://www.fiddler2.com/fiddler2/</a></p>
<p>The following transfer example is taken from:</p>
<p><a class="reference external" href="http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/FileReference.html">http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/FileReference.html</a></p>
<p>It includes examples two post parameters, api_sig and api_key. The name for the field where the file can be found is set to &#8220;photo&#8221; (Adobe default is &#8220;FileData&#8221; and FileUploader changes this default to &#8220;flashUploadFiles&#8221;).</p>
<div class="highlight-text"><div class="highlight"><pre>POST /handler.cfm HTTP/1.1
  Accept: text/*
  Content-Type: multipart/form-data;
  boundary=----------Ij5ae0ae0KM7GI3KM7ei4cH2ei4gL6
  User-Agent: Shockwave Flash
  Host: www.example.com
  Content-Length: 421
  Connection: Keep-Alive
  Cache-Control: no-cache

  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;Filename&quot;

  MyFile.jpg
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;api_sig&quot;

  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;api_key&quot;

  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;auth_token&quot;

  XXXXXXXXXXXXXXXXXXXXXX
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;photo&quot;; filename=&quot;MyFile.jpg&quot;
  Content-Type: application/octet-stream

  FileDataHere
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7
  Content-Disposition: form-data; name=&quot;Upload&quot;

  Submit Query
  ------------Ij5GI3GI3ei4GI3ei4KM7GI3KM7KM7--
</pre></div>
</div>
<p>Whether HTML or Flash, the payload is done with a multipart transfer. The file data is uploaded to a temp folder on the server. After the upload is complete, the server script is called. It is the job of the server script to know where this temp folder is and access the file (to move it to the destination, and or perform tasks upon it).</p>
<p>During a Flash multi-file upload, the images are uploaded in parallel (unless FileUploader.deferredUploading=true), however, the server script only receives one file at a time. So if five files are uploaded, the server script will be called five times.</p>
<p>During an HTML multi-file upload, the files are all uploaded at once, and after all five are completely uploaded to the temp folder, the server script is called just once. Each file will be referenced as numerically sequenced fields: uploadedfile0, uploadedfile1, uploadedfile2, etc. Single file uploads will of course call the server script once.</p>
<p>With a multipart request the POST data is the contents for the first part and the uploaded files is an array (or an object) of each additional part. Refer to your particular server documentation for how to reference the files (PHP is used as an example in the next section).</p>
<p>The return data needs to be formatted very specifically, ad there are different formats for Flash and HTML. See <strong>Server Side Return Data</strong> below.</p>
<div class="section" id="server-side-code-php">
<h3><a class="toc-backref" href="#id23">Server Side Code PHP</a><a class="headerlink" href="#server-side-code-php" title="Permalink to this headline">¶</a></h3>
<p>FlashUploader comes with a working PHP file, <em>dojox/form/resources/UploadFile.php</em>, to use as a reference for how your server side code should work. UploadFile.php has two dependencies, <em>dojo/tests/resources/JSON.php</em>, which is used for converting the return data to a JSO string, and <em>dojox/form/resources/cLog.php</em> which is used to log message to a text file, placed relative to the PHP file.</p>
<p>UploadFile.php is expecting one of three things:</p>
<ol class="arabic simple">
<li>A file or files from Flash</li>
<li>A file from HTML</li>
<li>Multiple files from HTML</li>
</ol>
<p>The PHP file is inspecting the header and looking for the parameters set in FileUploader: <em>htmlFieldName</em> or <em>flashFieldName</em>. Whatever you set these parameters to, they must match on the server. The current code uses &quot;flashUploadFiles&quot; as the default Flash field name. (The default field name in Flash is &quot;Filedata&quot;, which is over written to show that you can do custom field names). Therefore the server must be made aware of this parameter, as it is set on line 69: <em>$fieldName = &quot;flashUploadFiles&quot;;</em></p>
<p>The field name for the HTML uploader works much the same way. The only difference is if you do multi-file upload with HTML, this essentially continues to add fileInputs to the form, and in doing so, appends numbers to the fileInput field names, starting with '0'. That's why one file fieldname will look like &quot;myFieldName&quot; but two files will look like [ &quot;myFieldName0&quot;, &quot;myFieldName1&quot; ] to the server side code.</p>
</div>
<div class="section" id="server-side-return-data">
<h3><a class="toc-backref" href="#id24">Server Side Return Data</a><a class="headerlink" href="#server-side-return-data" title="Permalink to this headline">¶</a></h3>
<p>How the data is returned from the server is not difficult, but it is very important. If not done correctly, it can be the cause of reported errors that the &quot;onComplete&quot; is not firing in FileUploader.</p>
<p><strong>NOTE</strong> The Flash uploader and the HTML uploader need differently formatted return data. You will need to inspect the post data to determine which type to return.</p>
<p>If <em>flashFieldName</em> is found in the post data and Flash is being used on the client side, all that is needed for return data is a key-value string, and it can simply be returned, as at the end of a function. You may also want to insert <em>exit</em> or whatever necessary to cease execution of the remainder of the code. Example:</p>
<div class="highlight"><pre>$data .=&#39;file=&#39;.$file.&#39;,name=&#39;.$name.&#39;,width=&#39;.$width.&#39;,height=&#39;.$height.&#39;,type=&#39;.$type;
echo($data);
exit;
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">$data .='file='.$file.',name='.$name.',width='.$width.',height='.$height.',type='.$type;
echo($data);
exit;</textarea></div><p>For non-PHP devs this translates to:</p>
<div class="highlight-text"><div class="highlight"><pre>$name = name of the file, such as &quot;PIC01.jpg&quot;
$file = name of the file and the path, such as &quot;uploaded/PIC01.jpg&quot;
$width, $height = the dimensions (if you are working with images)
$type = the extension of the file - JPG, GIF, PNG, etc.
</pre></div>
</div>
<p>The return to Flash should look like:</p>
<div class="highlight-text"><div class="highlight"><pre>&quot;file=uploaded/PIC01.jpg,name=PIC01.jpg,width=320,height=240,type=jpg&quot;
</pre></div>
</div>
<p>This string should be returned, or printed, or echoed.</p>
<p>New in 1.4, you can add an error key if one file was in error; say if it was not of the correct type. This error code or message will be returned in the onComplete dataArray. It's important to note that as far as the FileUploader is concerned, everything was a success. It's up to your custom code to test for this error.</p>
<p>The return string with an error might look like:</p>
<div class="highlight-text"><div class="highlight"><pre>&quot;file=uploaded/PIC01.jpg,name=PIC01.jpg,width=320,height=240,type=jpg,error=Not recognized file type&quot;
</pre></div>
</div>
<p>You can also send back arbitrary parameters from your server-side script using this comma-delimitted format.  For example, adding variables foo and abc:</p>
<div class="highlight-text"><div class="highlight"><pre>&quot;file=uploaded/PIC01.jpg,name=PIC01.jpg,width=320,height=240,type=jpg,foo=bar,abc=123&quot;
</pre></div>
</div>
<p>Then you can access these variables in the client-side functions using dataArray[i].additionalParams.foo and dataArray[i].additionalParams.abc.</p>
<p>Note: there is an open ticket <a class="reference external" href="http://bugs.dojotoolkit.org/ticket/10576">http://bugs.dojotoolkit.org/ticket/10576</a> - when the uploader is set/forced to HTML mode, additionalParams is not created on the client side.  In the situation above dataArray[i].foo would exist though.</p>
<p>If <em>htmlFieldName</em> is used, the code on the client side gets pretty tricky, as an iframe is necessary for the file-post, and reading back from that iframe presents problems. In order to read the iframe return data accurately cross browser, the code needs to be wrapped in a <em>&lt;textarea&gt;</em>. You can see the code for this on the very last line of UploadFiles.php. Note that the textarea needs to be outside of the PHP. Example:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="cp">    ....code....</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;textarea&gt;</span><span class="cp">&lt;?php print $json-&gt;encode($dataObject); ?&gt;</span><span class="nt">&lt;/textarea&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;?php
    ....code....
?&gt;
&lt;textarea&gt;&lt;?php print $json-&gt;encode($dataObject); ?&gt;&lt;/textarea&gt;</textarea></div><p>For non-PHP devs, this translates into a JSON string, wrapped in a textarea, returned as HTML. I know it's screwy, but that's how it works.</p>
<p>If you are having problems getting onComplete to fire, look at this code first. Often the problem is the server side code is not catching the flash field name for whatever reason (perhaps the client and server names don't match) and the code is falling to the end of the page and returning a textarea to Flash. Recently Code has been added in the SWF that checks for this, so if that is the problem, you should be notified with a console message.</p>
</div>
<div class="section" id="https-issues">
<h3><a class="toc-backref" href="#id25">HTTPS Issues</a><a class="headerlink" href="#https-issues" title="Permalink to this headline">¶</a></h3>
<p>Attempting to upload to an HTTPS server can be very difficult in Firefox and Safari due to the fact that they do not share the same session as the browser page. IE has much fewer issues. Potential workarounds (mostly unverified as I do not have an HTTPS server to test with):</p>
<blockquote>
<div><ul class="simple">
<li>Here is the official Adobe bug report on the issue: <a class="reference external" href="https://bugs.adobe.com/jira/browse/FP-226">https://bugs.adobe.com/jira/browse/FP-226</a></li>
<li>Firefox does not like self signed security certificates. It has been said that an official signed cert will work.</li>
<li>It was brought to my attention that an .htaccess files on the server will work with the following content:</li>
</ul>
</div></blockquote>
<div class="highlight-text"><div class="highlight"><pre>&lt;IfModule mod_security.c&gt;
  SecFilterEngine Off
  SecFilterScanPOST Off
&lt;/IfModule&gt;
</pre></div>
</div>
<p>HOWEVER, this site says that opens you up to SQL injection attacks. He offers other solutions:
<a class="reference external" href="http://pumastudios.com/2009/05/file-uploads-and-mod_security-vs-wordpress-wp-adminadmin-ajaxphp">http://pumastudios.com/2009/05/file-uploads-and-mod_security-vs-wordpress-wp-adminadmin-ajaxphp</a></p>
<p>The original poster responds:</p>
<blockquote>
<div><p>This is not only a https issue. It's also on simple http connections. Ist a bug of adobe flash player in conjunction with the web application firewall (modsecurity). If i understand that correctly the flash player sends one &quot;\n\r&quot; instead but the http protocol requires &quot;\n\r\n\r&quot;. For modsecutiry this is a rule break so it delivers 403 rejected.</p>
<p>And yes if you disable modsecurity sql injections can be done on all post vars that are later processed by the database an not escaped within the application. So another safer way - until adobe fixed this problem and all flash players are updated - is the following but may not work on all servers:</p>
</div></blockquote>
<div class="highlight-text"><div class="highlight"><pre>&lt;IfModule mod_security.c&gt;
 SetEnvIfNoCase Content-Type &quot;^multipart/form-data;&quot; &quot;MODSEC_NOPOSTBUFFERING=Do not buffer file uploads&quot;
&lt;/IfModule&gt;
</pre></div>
</div>
<p>(Thanks to minobun for all the great info on this thorny issue)</p>
<dl class="docutils">
<dt>The other, less desirable solutions, are:</dt>
<dd><ul class="first last simple">
<li>Have an HTTP server to handle the uploads and use a crossdomain.xml file to handle the different protocol.</li>
<li>You may need to resort to force the HTML uploader.</li>
</ul>
</dd>
<dt>More references to this issue:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://bugs.dojotoolkit.org/ticket/8911">http://bugs.dojotoolkit.org/ticket/8911</a></li>
<li><a class="reference external" href="http://bugs.dojotoolkit.org/ticket/10306">http://bugs.dojotoolkit.org/ticket/10306</a></li>
<li><a class="reference external" href="http://wiki.modxcms.com/index.php/What_is_mod_security_and_how_does_it_affect_me">http://wiki.modxcms.com/index.php/What_is_mod_security_and_how_does_it_affect_me</a></li>
<li><a class="reference external" href="http://www.modsecurity.org/documentation/modsecurity-apache/1.9.3/html-multipage/06-special_features.html">http://www.modsecurity.org/documentation/modsecurity-apache/1.9.3/html-multipage/06-special_features.html</a></li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="demos">
<h2><a class="toc-backref" href="#id26">Demos</a><a class="headerlink" href="#demos" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploader.html">http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploader.html</a></li>
<li><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/demos/uploader/demo.html">http://mwilcox.dojotoolkit.org/dtk/demos/uploader/demo.html</a></li>
<li><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderForm.html">http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderForm.html</a></li>
<li><a class="reference external" href="http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderCSS.html">http://mwilcox.dojotoolkit.org/dtk/dojox/form/tests/test_FileUploaderCSS.html</a></li>
</ul>
</div></blockquote>
</div>
</div>


      </div>
    </div>
      <div class="clearer"></div>
    </div>

  <div class="row">
    <div class="medium-9 columns offset-3">
        <a href="https://docs.google.com/spreadsheet/viewform?hl=en_US&formkey=dFlDcHEyaHMwbEd4MFBObkNrX0E1MFE6MQ&entry_0=http%3A%2F%2Fdojotoolkit.org%2Freference-guide%2F1.10%2F">Error in the documentation? Can’t find what you are looking for? Let us know!</a>
        <div class="footer">
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-22088032-1', 'auto');
		ga('send', 'pageview');

	</script>
</div>
    </div>
  </div>
  
  </body>
</html>